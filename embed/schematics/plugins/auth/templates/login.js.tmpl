// static/js/src/components/login.js

import { withApi } from '../alpine-mixins.js';
import { apiFetch } from '../api.js';

// This is our component definition. It's just a function.
export const login = () => ({
    // Use the spread operator to include our reusable logic
    ...withApi(),

    // Component-specific data
    form: {
        email: '',
        password: ''
    },
    isLoading: false,

    // Handle form submission
    async submitLogin() {
        this.isLoading = true;
        await this.handleApiCall(async () => {
            let result;
            try {
              result = await apiFetch('/login', {
                  method: 'POST',
                  body: {
                      email: this.form.email,
                      password: this.form.password
                  }
              });

              // Show success message and redirect on successful login
              Alpine.store('notifications').show('Login successful!', 'success');
              setTimeout(() => {
                  window.location.href = '/dashboard';
              }, 1000);
            } catch (error) {
              // Show error message
              Alpine.store('notifications').show(error, 'error');
            } finally {
              this.isLoading = false;
            }

            return result;
        });
    },

    // Initialize component
    init() {
        // Component is ready
    }
});
