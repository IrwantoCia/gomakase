// static/js/src/components/register.js

import { withApi } from '../alpine-mixins.js';
import { apiFetch } from '../api.js';

// This is our component definition. It's just a function.
export const register = () => ({
    // Use the spread operator to include our reusable logic
    ...withApi(),

    // Component-specific data
    form: {
        email: '',
        password: '',
        confirmPassword: ''
    },
    isLoading: false,

    // Handle form submission
    async submitRegister() {
        this.isLoading = true;
        await this.handleApiCall(async () => {
            let result;
            try {
              result = await apiFetch('/register', {
                  method: 'POST',
                  body: {
                      email: this.form.email,
                      password: this.form.password,
                      confirmPassword: this.form.confirmPassword
                  }
              });

              // Show success message and redirect on successful login
              Alpine.store('notifications').show('Register successful!', 'success');
              setTimeout(() => {
                  window.location.href = '/login';
              }, 1000);
            } catch (error) {
              // Show error message
              Alpine.store('notifications').show(error, 'error');
            } finally {
              this.isLoading = false;
            }

            return result;
        });
    },

    // Initialize component
    init() {
        // Component is ready
    }
});
