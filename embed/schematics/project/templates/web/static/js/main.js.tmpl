// main.js
import Alpine from 'alpinejs';
import components from './component.js';

if (typeof window !== 'undefined') {
    sessionStorage.removeItem('alpine:notifications');
}

document.addEventListener('alpine:init', () => {
    // Global store for notifications
    Alpine.store('notifications', {
        message: '',
        type: 'success', // 'success' or 'error'
        visible: false,
        timer: null,

        init() {
          // Clear any leftover notifications on page load
          this.hide();
          clearTimeout(this.timer);
        },

        // Force clear immediately
        clear() {
          this.visible = false;
          this.message = '';
          this.type = '';
          if (this.timer) {
            clearTimeout(this.timer);
            this.timer = null;
          }
        },

        show(message, type = 'success') {
            clearTimeout(this.timer);
            this.message = message;
            this.type = type;
            this.visible = true;
            // Hide after 5 seconds
            this.timer = setTimeout(() => { this.hide() }, 5000);
        },

        hide() {
            this.visible = false;
            this.message = '';
            this.type = '';
        }
    });

    Object.entries(components).forEach(([key, component]) => {
        Alpine.data(key, component);
    });

});

window.Alpine = Alpine;
Alpine.start();
